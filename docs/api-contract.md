# API Contract (Draft)

This document defines the API surface exposed to the Operations Dashboard.
The API service is intentionally thin and read-only. It does not execute
recovery actions; it only exposes the latest system state and decisions
generated by the streaming and orchestration layers.

The purpose of this contract is to clearly define:
- what data the UI can request,
- what shape the responses take,
- how downstream systems reason about disruptions.

---

## Base URL
- Local: http://localhost:8000
- Hosted: To be configured during deployment

---

## General Conventions
- All timestamps are ISO-8601 (UTC)
- All IDs are opaque strings
- All responses are JSON
- Errors return a structured payload

Example error:
```json
{
  "error": "Disruption not found",
  "request_id": "req_123"
}
```



## 1) Health Check
```json
{
  "status": "ok",
  "service": "api-service",
  "time": "2025-12-28T00:00:00Z"
}
```

## 2) Disruptions (Incident Feed)

**GET /disruptions**

```json
{
  "items": [
    {
      "disruption_id": "dsp_123",
      "severity": "HIGH",
      "airport": "SFO",
      "region": "US-WEST",
      "primary_flight_number": "UA123",
      "metrics": {
        "delayed_flights_count": 14,
        "cancelled_flights_count": 3,
        "passengers_impacted_est": 640,
        "connections_at_risk_est": 120
      },
      "last_updated": "2025-12-28T00:00:00Z"
    }
  ]
}
```

## 3) Disruption Detail (Case View)

**GET /disruptions/{disruption_id}**

```json
{
  "disruption_id": "dsp_123",
  "severity": "HIGH",
  "scope": {
    "airport": "SFO",
    "region": "US-WEST",
    "primary_flight_number": "UA123"
  },
  "metrics": {
    "delayed_flights_count": 14,
    "cancelled_flights_count": 3,
    "avg_delay_minutes": 52,
    "passengers_impacted_est": 640,
    "connections_at_risk_est": 120
  },
  "cohorts": [
    {
      "cohort_id": "c_001",
      "priority": "P0",
      "reason": "SPECIAL_ASSISTANCE",
      "passenger_count": 18
    }
  ],
  "last_updated": "2025-12-28T00:00:00Z"
}
```

## 4) Passenger Cohorts

**GET /disruptions/{disruption_id}/cohorts**

```json
{
  "disruption_id": "dsp_123",
  "cohorts": [
    {
      "cohort_id": "c_001",
      "priority": "P0",
      "reason": "SPECIAL_ASSISTANCE",
      "passengers": [
        {
          "passenger_id": "p_9001",
          "pnr": "AB12CD",
          "loyalty_tier": "GOLD",
          "special_assistance": true,
          "itinerary": {
            "flight_number": "UA123",
            "origin_airport": "SFO",
            "destination_airport": "ORD",
            "scheduled_departure": "2025-12-28T01:10:00Z",
            "connection_flight_number": "UA456"
          }
        }
      ]
    }
  ]
}
```

## 5) Recovery Actions

**GET /disruptions/{disruption_id}/actions**

```json
{
  "disruption_id": "dsp_123",
  "actions": [
    {
      "action_id": "a_001",
      "action_type": "REBOOK",
      "priority": "P0",
      "target": {
        "pnr": "AB12CD",
        "passenger_id": "p_9001"
      },
      "details": {
        "recommended_option": "UA789 SFOâ†’ORD 03:10Z",
        "notes": "Auto-protect under policy"
      },
      "status": "VALIDATED",
      "created_at": "2025-12-28T00:02:00Z"
    }
  ]
}
```

## 6) Audit Trail (Decision Explainability)
**GET /disruptions/{disruption_id}/audit**

```json
{
  "disruption_id": "dsp_123",
  "model": {
    "provider": "vertex_ai",
    "name": "gemini",
    "version": "tbd"
  },
  "decision_summary": {
    "severity": "HIGH",
    "total_actions": 32,
    "key_reasons": [
      "high cancellations",
      "connection risk",
      "limited capacity"
    ]
  },
  "safety_and_guardrails": {
    "validated": true,
    "blocked_actions": 2,
    "notes": "Blocked hotel offers for non-overnight delays"
  },
  "performance": {
    "end_to_end_latency_ms": 1240,
    "model_latency_ms": 680
  },
  "created_at": "2025-12-28T00:02:01Z"
}
```
